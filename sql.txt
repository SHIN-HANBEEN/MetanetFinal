-- Drop existing tables
DROP TABLE RESERVATIONS CASCADE CONSTRAINTS;
DROP TABLE NOTICES CASCADE CONSTRAINTS;
DROP TABLE DISCOUNTS CASCADE CONSTRAINTS;
DROP TABLE MEMBERS CASCADE CONSTRAINTS;
DROP TABLE BUSES CASCADE CONSTRAINTS;
DROP TABLE SEATS CASCADE CONSTRAINTS;
DROP TABLE TERMINALS CASCADE CONSTRAINTS;
DROP TABLE ROUTES CASCADE CONSTRAINTS;
DROP TABLE NONMEMBERS CASCADE CONSTRAINTS;

-- Create tables with new schema
CREATE TABLE DISCOUNTS (
    DISOUNT_ID NUMBER(2) PRIMARY KEY,
    DISCOUNT_TYPE VARCHAR2(20),
    DISCOUNT_RATE FLOAT
);

CREATE TABLE MEMBERS (
    MEMBER_ID NUMBER(8) PRIMARY KEY,
    ID VARCHAR2(30) UNIQUE,
    PASSWORD VARCHAR2(80),
    EMAIL VARCHAR2(30),
    BIRTH_DATE DATE,
    SEX VARCHAR(6),
    NAME VARCHAR2(20),
    PHONE_NUM VARCHAR2(15),
    ROLE VARCHAR2(15),
    MILEAGE NUMBER(6)
);

CREATE TABLE NONMEMBERS (
    NMEMBER_ID NUMBER(8) PRIMARY KEY,
    PHONE_NUM VARCHAR2(15)
);

CREATE TABLE TERMINALS (
    TERMINAL_ID VARCHAR2(15) PRIMARY KEY,
    TERMINAL_NAME VARCHAR2(20),
    CITY_ID NUMBER(2) NOT NULL,
    CITY_NAME VARCHAR2(20)
);

CREATE TABLE ROUTES (
    ROUTE_ID VARCHAR2(40) PRIMARY KEY,
    DEPARTURE_ID VARCHAR2(15) REFERENCES TERMINALS(TERMINAL_ID),
    ARRIVAL_ID VARCHAR2(15) REFERENCES TERMINALS(TERMINAL_ID),
    DEPARTURE_TIME DATE,
    ARRIVAL_TIME DATE,
    PRICE NUMBER(6)
);

CREATE TABLE BUSES (
    BUS_ID NUMBER(6) PRIMARY KEY,
    ROUTE_ID VARCHAR2(40) REFERENCES ROUTES(ROUTE_ID),
    GRADE_NAME VARCHAR2(21),
    SEAT_CNT NUMBER(2)
);

CREATE TABLE SEATS (
    SEAT_ID NUMBER(2) PRIMARY KEY,
    BUS_ID NUMBER(6) REFERENCES BUSES(BUS_ID),
    IS_RES VARCHAR2(6)
);

CREATE TABLE RESERVATIONS (
    RES_ID NUMBER(8) PRIMARY KEY,
    MEMBER_ID NUMBER(8) REFERENCES MEMBERS(MEMBER_ID),
    NMEMBER_ID NUMBER(8) REFERENCES NONMEMBERS(NMEMBER_ID),
    ROUTE_ID VARCHAR2(40) REFERENCES ROUTES(ROUTE_ID),
    BUS_ID NUMBER(6) REFERENCES BUSES(BUS_ID),
    SEAT_ID NUMBER(2),
    DISOUNT_ID NUMBER(2) REFERENCES DISCOUNTS(DISOUNT_ID),
    RES_DATE DATE,
    PAY_ID VARCHAR(30),
    TOTAL_PRICE NUMBER(8),
    IS_CANCLED VARCHAR2(5),
    CANCLED_DATE DATE
);

CREATE TABLE NOTICES (
    NOTICE_ID NUMBER(4) PRIMARY KEY,
    MEMBER_ID NUMBER(8) REFERENCES MEMBERS(MEMBER_ID),
    TITLE VARCHAR2(20),
    CONTENT VARCHAR2(2000),
    DIR_PATH VARCHAR2(200)
);
