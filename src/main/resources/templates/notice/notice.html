<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<title>MetaBus</title>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
	<!--     Fonts and icons     -->
	<link rel="stylesheet" type="text/css"
		href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900|Roboto+Slab:400,700" />
	<!-- Nucleo Icons -->
	<link href="/assets/css/nucleo-icons.css" rel="stylesheet" />
	<link href="/assets/css/nucleo-svg.css" rel="stylesheet" />
	<!-- Font Awesome Icons -->
	<script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
	<!-- Material Icons -->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

	<link href="/assets/css/material-kit.css?v=3.0.0" rel="stylesheet" />

	<!-- 커스텀 CSS -->
	<link href="/assets/css/final.css" rel="stylesheet" />
	<link type="text/css" rel="stylesheet" href="/assets/css/seat2.css">

	<!-- KoPub 폰트 -->
	<link rel='stylesheet' href='//cdn.jsdelivr.net/npm/font-kopub@1.0/kopubdotum.min.css'>

	<!-- payment form -->
	<!--
		<link rel='stylesheet' href="/assets/css/payment.css" />
	-->

</head>

<body>
	<div th:replace="~{fragments/navbarFragment :: navbar}"></div>
	<!-- Include navbar fragment -->

	<!-- container fluid -->
	<div class="container-fluid">
		<div class="row justify-content-md-center">
			<div class="col-lg-12 metanet-page-header pb-6"
				style="height: 100%; min-height: 100vh; background-image: url('../assets/img/bus.png');">
				<span class="mask bg-gradient-dark opacity-6"></span>


				<div class="container-fluid" style="margin-top: 23%;">
					<div class="row" style="text-align: center;">
						<!-- 좌석조회 카드 -->
						<div class="col-lg-12 mb-5" style="z-index: 10;">
							<div class="container bg-body-tertiary rounded-4 mt-n12" style="min-height: 80vh; max-height: 160vh;">

								<div class="section text-center" id="noticeContent">
									<h2 class="title pb-3 pt-4">공지사항</h2>

									<!-- 공지사항 컨테이너 -->
									<div class="row">
										<div class="col-2">

										</div>

										<div class="col-8">
											<hr class="dark horizontal mt-0 mb-2">
											<table class="table table-hover" id="noticeTable">
												<thead>
													<tr>
														<th class="col-2" scope="col">공지번호</th>
														<th class="col-8" scope="col">제목</th>
														<th class="col-2" scope="col">작성자</th>
													</tr>
												</thead>
												<tbody id="noticeTableBody">
													<!-- tbody 는 비동기로 가져온다. -->
													<!--<tr>
														<th scope="row">1</th>
														<td>Mark</td>
														<td>Otto</td>
													</tr>-->

												</tbody>
											</table>
										</div>

										<div class="col-2">

										</div>


										<!-- 공지 검색 관련 친구들
										 -->
										<div class="col-2">

										</div>
										<div class="col-8">
											<div class="row">
												<div class="col-8">
													<!-- d-flex 로 만들어서 블록 요소들을 한 line 에 두도록 만든다. -->
													<div class="d-flex align-items-center">
														<div class="d-inline-block form-check form-switch my-4 mb-2 d-flex align-items-center">
															<input class="form-check-input" type="checkbox" id="IsNoticeNumberSearch" checked="">
															<label class="form-check-label ms-3 mb-0 text-dark" for="IsNoticeNumberSearch">
																공지 번호
														</div>
														<div class="d-inline-block form-check form-switch my-4 mb-2 d-flex align-items-center">
															<input class="form-check-input mx-1" type="checkbox" id="IsNoticeTitleSearch" checked="">
															<label class="form-check-label ms-3 mb-0 text-dark" for="IsNoticeTitleSearch">
																공지 제목
														</div>
														<div class="d-inline-block my-4 mb-2 ms-4" style="font-size: 70%;">
															검색할 항목을 선택하세요. (중복 선택 가능)
														</div>
													</div>
												</div>
												<div class="col-4">
												</div>
											</div>
											<div class="input-group input-group-dynamic mb-4">
												<span class="input-group-text"><i class="fas fa-search" aria-hidden="true"></i></span>
												<input class="form-control" placeholder="검색 내용 입력" type="text">
											</div>
										</div>
										<div class="col-2">

										</div>

										<!-- 페이지 번호
										 -->
										<div class="col-2">

										</div>

										<div class="col-8">
											<div class="row">
												<div class="col-3">

												</div>
												<div class="col-6 mb-3">
													<nav aria-label="Page navigation example">
														<ul class="pagination justify-content-center">
															<li class="page-item mx-2">
																<a class="page-link" href="javascript:;" aria-label="Previous">
																	<i class="fa fa-angle-left"></i>
																	<span class="sr-only">Previous</span>
																</a>
															</li>
															<li class="page-item mx-1">
																<a class="page-link" href="javascript:;">
																	1
																</a>
															</li>
															<li class="page-item mx-1">
																<a class="page-link" href="javascript:;">
																	2</a>
															</li>
															<li class="page-item mx-1">
																<a class="page-link" href="javascript:;">
																	3</a>
															</li>
															<li class="page-item mx-1">
																<a class="page-link" href="javascript:;">
																	4</a>
															</li>
															<li class="page-item mx-1">
																<a class="page-link" href="javascript:;">
																	5</a>
															</li>
															<li class="page-item mx-2">
																<a class="page-link" href="javascript:;" aria-label="Next">
																	<i class="fa fa-angle-right"></i>
																	<span class="sr-only">Next</span>
																</a>
															</li>
														</ul>
													</nav>
												</div>
												<div class="col-3" sec:authorize="hasRole('ADMIN')">
													<div class="row">
														<div class="col-6">

														</div>
														<div class="col-6 p-0 m-0">
															<button type="button" id="noticeRegisterButton" class="btn btn-sm bg-gradient-info"
																style="font-size: 80%; position: relative; left: -10%;">
																공지등록
															</button>
														</div>
													</div>
												</div>
											</div>

										</div>

										<div class="col-2">

										</div>

									</div>


								</div>
							</div>




						</div>
					</div>
				</div>
			</div>
		</div>
	</div>




































	<!-- footer -->
	<!-- Include footer fragment -->
	<div th:replace="~{fragments/footerFragment :: footer}"></div>

	<!--   Core JS Files   -->
	<script src="/assets/js/core/popper.min.js" type="text/javascript"></script>
	<script src="/assets/js/core/bootstrap.min.js" type="text/javascript"></script>
	<script src="/assets/js/plugins/perfect-scrollbar.min.js"></script>

	<!--  Plugin for TypedJS, full documentation here: https://github.com/inorganik/CountUp.js -->
	<script src="/assets/js/plugins/countup.min.js"></script>
	<script src="/assets/js/plugins/choices.min.js"></script>
	<script src="/assets/js/plugins/prism.min.js"></script>
	<script src="/assets/js/plugins/highlight.min.js"></script>

	<!--  Plugin for Parallax, full documentation here: https://github.com/dixonandmoe/rellax -->
	<script src="/assets/js/plugins/rellax.min.js"></script>

	<!--  Plugin for TiltJS, full documentation here: https://gijsroge.github.io/tilt.js/ -->
	<script src="/assets/js/plugins/tilt.min.js"></script>

	<!--  Plugin for Selectpicker - ChoicesJS, full documentation here: https://github.com/jshjohnson/Choices -->
	<script src="/assets/js/plugins/choices.min.js"></script>
	<script src="/assets/js/material-kit.min.js?v=3.0.4" type="text/javascript"></script>
	<!-- 메타넷 final js -->
	<!--<script src="/assets/js/final.js" type="text/javascript"></script>-->
	<!-- jQuery js -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	<!-- iamport.payment.js -->
	<script src="https://cdn.iamport.kr/v1/iamport.js"></script>


	<script>
		document.addEventListener('DOMContentLoaded', function () {
			const offset = 0; //페이징 처음에는 0으로 처리


			//게시글 등록 불러오는 처리
			function checkButtonExistence() {
				const noticeRegisterBtn = document.getElementById('noticeRegisterButton');
				const noticeContent = document.getElementById('noticeContent');

				if (noticeRegisterBtn) {
					console.log('noticeRegisterBtn이 읽혔어요.');
					clearInterval(intervalId); // Stop checking

					console.log('dom 읽기가 완료되었어요.');

					noticeRegisterBtn.addEventListener('click', function () {
						console.log('noticeBtn이 클릭되었습니다');

						const xhr = new XMLHttpRequest();

						xhr.open('GET', '/notice/register', true);

						xhr.onload = function () {
							if (xhr.status === 200) {
								console.log('response 에요 : ' + xhr.responseText);
								noticeContent.innerHTML = xhr.responseText
								if (xhr.responseText) {

								} else {
									console.error('공지 작성을 위한 htmlcontent 가 없어요');
								}
							} else {
								console.error('공지 작성 가져오다 오류가 발생했어요', xhr.status, xhr.statusText);
							}
						};

						xhr.onerror = function () {
							console.error('통신 중 에러가 발생했어요');
						};

						xhr.send();
					});
					// Your remaining code here
				} else {
					console.log('noticeRegisterBtn을 못 읽어왔네요.');
				}
			}
			const intervalId = setInterval(checkButtonExistence, 1000); // Check every second


			//notice table 만드는 코드
			function fetchNoticeList(offset) {
				const xhr = new XMLHttpRequest();
				xhr.onreadystatechange = function () {
					if (xhr.readyState === 4 && xhr.status === 200) {
						const noticeList = JSON.parse(xhr.responseText);
						updateTableBody(noticeList);
					}
				};
				xhr.open('GET', '/notice/list?offset=' + offset, true);
				xhr.send();
			}
			function updateTableBody(noticeList) {
				const tbody = document.getElementById('noticeTableBody');
				tbody.innerHTML = '';

				for (var i = 0; i < noticeList.length; i++) {
					var notice = noticeList[i];
					//N.NOTICE_ID, N.TITLE, M.MEMBER_ID 
					var row = document.createElement('tr');
					row.innerHTML = '<th scope="row">' + notice.noticeId + '</th>' +
						// '<td><a href=/notice/read?noticeId=' + notice.noticeId + '&offset=' + offset + '>' + notice.title + '</a></td>' +
						'<td><a style=cursor:pointer class=noticeTitle id=notice' + notice.noticeId + '>' + notice.title + '</a></td>' +
						'<td>' + notice.name + '</td>';
					tbody.appendChild(row);

					const titleA = document.getElementById('notice' + notice.noticeId);
					if (titleA) {
						titleA.addEventListener('click', function () {
							const xhr = new XMLHttpRequest();
							xhr.onreadystatechange = function () {
								if (xhr.readyState === 4 && xhr.status === 200) {
									console.log('공지 읽기 html : ' + xhr.responseText);
									const noticeReadHtml = xhr.responseText;
									updateNoticeContentForReadNotice(noticeReadHtml);
								}
							};
							xhr.open('GET', '/notice/read?noticeId=' + notice.noticeId + '&offset=' + offset, true);
							xhr.send();
						});
						function updateNoticeContentForReadNotice(content) {
							const noticeContent = document.getElementById('noticeContent');
							noticeContent.innerHTML = content;
						}
					}
				}
			}
			//Notice 초기값은 offset(0) 으로 보냅니다. 
			fetchNoticeList(offset);



		});



		function updateIsEmphasizedValue() {
			const isEmphasizedInput = document.getElementById('isEmphasized');
			const isEmphasizedCheckBox = document.getElementById('isEmphasizedCheckBox');
			console.log('중요 공지 여부 확인 실행됨');
			alert('일시정지');
			// Set the value of the isEmphasized input based on the state of the checkbox
			isEmphasizedInput.value = isEmphasizedCheckBox.checked ? 'TRUE' : 'FALSE';
		}
	</script>

	<!--   Core JS Files   -->
	<!-- <script src="/assets/js/core/popper.min.js" type="text/javascript"></script>
    <script src="/assets/js/core/bootstrap.min.js" type="text/javascript"></script>
    <script src="/assets/js/plugins/perfect-scrollbar.min.js" type="text/javascript"></script>
    <script src="/assets/js/plugins/moment.min.js"></script>

    <script src="/assets/js/material-kit.min.js" type="text/javascript"></script> -->
</body>

</html>